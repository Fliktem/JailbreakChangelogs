window.notyf=new Notyf({duration:4500,position:{x:"right",y:"bottom"},types:[{type:"info",background:"#2196f3",dismissible:!0,icon:!1},{type:"success",background:"#4caf50",dismissible:!0,icon:!1},{type:"warning",background:"#ff9800",dismissible:!0,icon:!1},{type:"error",background:"#b20b0b",dismissible:!0,icon:!1},{type:"special",background:"#9c27b0",dismissible:!0,icon:!1}],ripple:!0,dismissible:!0,rippleEffect:!0}),window.notyf.info=e=>window.notyf.open({type:"info",message:e}),window.notyf.success=e=>window.notyf.open({type:"success",message:e}),window.notyf.warning=e=>window.notyf.open({type:"warning",message:e}),window.notyf.error=e=>window.notyf.open({type:"error",message:e}),window.notyf.special=e=>window.notyf.open({type:"special",message:e});let globalUserData=null;const token=Cookies.get("token"),userid=localStorage.getItem("userid");function parseUserData(){try{const e=localStorage.getItem("user");return e?JSON.parse(e):null}catch(e){return console.error("Failed to parse user data:",e),null}}function cleanupURL(){const e=new URL(window.location);e.searchParams.has("report-issue")&&(e.searchParams.delete("report-issue"),window.history.replaceState({},"",e.toString()))}function formatStamp(e){return new Date(1e3*e).toUTCString()}function checkWebsiteVersion(){fetch("https://api3.jailbreakchangelogs.xyz/version/website").then((e=>e.json())).then((e=>{updateVersionDisplay({version:e.version,date:formatStamp(e.last_updated)})})).catch((e=>{console.error("Failed to fetch version data:",e)}))}function updateVersionDisplay(e){const t=(e,o)=>{const n=document.getElementById(e);n?n.textContent=o:setTimeout((()=>t(e,o)),100)};t("last-updated",e.date),t("version-number",e.version)}globalUserData=parseUserData(),document.addEventListener("DOMContentLoaded",(function(){const e=new URLSearchParams(window.location.search);if(e.has("freshlogin")&&function(){if(globalUserData){const e=globalUserData.username||globalUserData.global_name;e&&notyf.special(`Hello, ${e}!`)}window.history.replaceState({},"",window.location.pathname)}(),e.has("report-issue")){if(!token)return notyf.error("Please sign in to report issues"),localStorage.setItem("reportIssueRedirect","true"),void setTimeout((()=>{window.location.href="/login?redirect="+encodeURIComponent(window.location.pathname+window.location.search)}),3e3);document.querySelector('[data-bs-target="#reportIssueModal"]')?.click(),cleanupURL()}if(token&&localStorage.getItem("reportIssueRedirect"))return localStorage.removeItem("reportIssueRedirect"),void(window.location.href="/?report-issue");const t=document.querySelector('[data-bs-target="#reportIssueModal"]');if(token){t.classList.remove("disabled"),t.removeAttribute("title"),t.style.cursor="pointer";const e=userid||globalUserData.id;t.addEventListener("click",(()=>{document.getElementById("reportIssueForm").reset(),document.getElementById("successMessage").classList.add("d-none");document.getElementById("reportIssueForm").querySelectorAll("input, textarea").forEach((e=>e.disabled=!1)),document.getElementById("submitIssue").disabled=!1})),document.getElementById("submitIssue").addEventListener("click",(function(){const t=document.getElementById("issueTitle").value,o=document.getElementById("issueDescription").value;document.querySelectorAll(".invalid-feedback").forEach((e=>e.remove())),document.getElementById("issueTitle").classList.remove("is-invalid"),document.getElementById("issueDescription").classList.remove("is-invalid");let n=!1;if(o.length<25){document.getElementById("issueDescription").classList.add("is-invalid"),n=!0,notyf.error("Description must be at least 25 characters long")}if(t.length<10){document.getElementById("issueTitle").classList.add("is-invalid"),n=!0,notyf.error("Title must be at least 10 characters long")}if(n)return;const a=document.getElementById("reportIssueForm"),r=document.getElementById("submitIssue");a.querySelectorAll("input, textarea").forEach((e=>e.disabled=!0)),r.disabled=!0,fetch("https://api3.jailbreakchangelogs.xyz/issues/add",{method:"POST",headers:{"Content-Type":"application/json",Origin:"jailbreakchangelogs.xyz"},body:JSON.stringify({user:e,title:t,description:o})}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=document.getElementById("successMessage");t.classList.remove("d-none"),cleanupURL(),setTimeout((()=>{bootstrap.Modal.getInstance(document.getElementById("reportIssueModal")).hide(),setTimeout((()=>{a.reset(),t.classList.add("d-none"),a.querySelectorAll("input, textarea").forEach((e=>e.disabled=!1)),r.disabled=!1}),500)}),2e3)})).catch((e=>{console.error("Error submitting issue:",e),notyf.error("There was an error submitting your issue. Please try again."),a.querySelectorAll("input, textarea").forEach((e=>e.disabled=!1)),r.disabled=!1}))}))}else t.classList.add("disabled"),t.removeAttribute("data-bs-target"),t.onclick=e=>{e.preventDefault(),notyf.error("Please sign in to report issues"),setTimeout((()=>{window.location.href="/login"}),3e3)};const o=document.getElementById("sideMenu"),n=document.getElementById("mobileViewUpdates");function a(){mobileAvatarToggle.classList.toggle("opened"),o.classList.toggle("show"),document.body.classList.toggle("menu-open");const e=mobileAvatarToggle.classList.contains("opened");mobileAvatarToggle.setAttribute("aria-expanded",e)}window.checkAndSetAvatar=async function(e){const t=`https://ui-avatars.com/api/?background=134d64&color=fff&size=128&rounded=true&name=${encodeURIComponent(e.username)}&bold=true&format=svg`;async function o(e,t=null){const o=t?`${e}?size=${t}`:e;try{return(await fetch(o,{method:"HEAD"})).ok?o:null}catch{return null}}try{const n=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.gif`,a=await o(n,4096);if(a)return a;const r=await o(n);if(r)return r;const s=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp`,i=await o(s,4096);if(i)return i;const c=await o(s);return c||t}catch{return t}},mobileAvatarToggle.addEventListener("click",a),n&&n.addEventListener("click",a),o.querySelectorAll(".nav-link, .btn").forEach((e=>{e.addEventListener("click",a)}))})),document.addEventListener("DOMContentLoaded",(async()=>{checkWebsiteVersion(),window.checkAndSetAvatar=async function(e){if(!e||!e.username)return null;const t=`https://ui-avatars.com/api/?background=134d64&color=fff&size=128&rounded=true&name=${encodeURIComponent(e.username)}&bold=true&format=svg`;async function o(e,t=null){const o=t?`${e}?size=${t}`:e;try{return(await fetch(o,{method:"HEAD"})).ok?o:null}catch{return null}}try{const n=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.gif`,a=await o(n,4096);if(a)return a;const r=await o(n);if(r)return r;const s=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp`,i=await o(s,4096);if(i)return i;const c=await o(s);return c||t}catch{return t}};let e=null;try{const t=localStorage.getItem("user");e=t?JSON.parse(t):null}catch(e){console.error("Failed to parse user data:",e)}const t=new URLSearchParams(window.location.search);if((t.has("freshlogin")||t.has("report-issue"))&&(e&&(e.global_name||e.username)&&notyf.special(`Hello, ${e.global_name||e.username}!`),window.history.replaceState({},"",window.location.pathname)),!token&&(globalUserData||userid))return void a();if(token)try{const e=await fetch("https://api3.jailbreakchangelogs.xyz/users/get/token?token="+token);if(!e.ok)throw new Error("Invalid response");const t=await e.json();if(!t)return void a();if(globalUserData=t,localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("userid",t.id),t.id&&t.avatar){const e=await window.checkAndSetAvatar(t);if(e){localStorage.setItem("avatar",e);const t=document.getElementById("profile-picture"),o=document.getElementById("profile-picture-mobile");t&&(t.src=e),o&&(o.src=e)}}}catch(e){console.error("Error fetching user data:",e),a()}const o=JSON.parse(localStorage.getItem("user")||"{}");if(t.has("freshlogin")||t.has("report-issue")){o&&o.global_name?notyf.special(`Hello, ${o.global_name}!`):o&&o.username&&notyf.special(`Hello, ${o.username}!`);const e=window.location.pathname;window.history.replaceState({},"",e)}const n=localStorage.getItem("user");function a(){globalUserData=null,localStorage.removeItem("avatar"),localStorage.removeItem("user"),localStorage.removeItem("userid"),localStorage.removeItem("showWelcome"),Cookies.remove("token",{path:"/",secure:!0,sameSite:"Strict"}),window.location.reload()}if(!token&&(n||userid))return void a();if(token)try{const e=await fetch("https://api3.jailbreakchangelogs.xyz/users/get/token?token="+token);if(!e.ok)throw new Error("Invalid response");const t=await e.json();if(!t)return void a();const o=await window.checkAndSetAvatar(t);localStorage.setItem("avatar",o),localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("userid",t.id);const n=document.getElementById("profile-picture"),r=document.getElementById("profile-picture-mobile");n&&(n.src=o),r&&(r.src=o)}catch(e){console.error("Error fetching user data:",e),localStorage.removeItem("avatar"),localStorage.removeItem("user"),localStorage.removeItem("userid"),window.location.reload()}let r,s=0;function i(){const e=document.querySelector(".modal"),t=document.querySelector(".modal-backdrop");e&&e.remove(),t&&t.remove(),document.body.style.overflow="auto"}document.addEventListener("keydown",(e=>{"Escape"===e.key&&(s++,1===s&&(r=setTimeout((()=>{s=0}),3e3)),5===s&&(clearTimeout(r),s=0,function(){const e=document.createElement("div");e.className="modal fade show",e.style.cssText="\n      display: inline-block !important;\n      min-width: 100% !important;\n      justify-content: center !important;\n      align-items: center !important;\n      background-color: rgba(0, 0, 0, 0.5) !important;\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      z-index: 1050 !important;\n      height: 100vh !important;\n    ";const t=document.createElement("div");t.className="modal-dialog",t.style.cssText="\n      margin: 1.75rem auto !important;\n      max-width: 500px !important;\n    ";const o=document.createElement("div");o.className="modal-content bg-dark",o.style.cssText="\n      background-color: #212529 !important;\n      color: #fff !important;\n      border: 1px solid rgba(255, 255, 255, 0.125) !important;\n    ";const n=document.createElement("div");n.className="modal-header",n.style.cssText="\n      border-bottom: 1px solid rgba(255, 255, 255, 0.125) !important;\n      padding: 1rem !important;\n    ";const a=document.createElement("h5");a.className="modal-title",a.innerText="Login with Token",a.style.cssText="\n      color: #fff !important;\n      margin: 0 !important;\n    ";const r=document.createElement("div");r.className="modal-body",r.style.cssText="\n      padding: 1rem !important;\n    ";const s=document.createElement("input");s.type="text",s.className="form-control bg-dark text-light",s.placeholder="Enter your token",s.autocomplete="off",s.spellcheck=!1,s.setAttribute("autocorrect","off"),s.setAttribute("autocapitalize","off"),s.style.cssText="\n      background-color: var(--bg-secondary) !important;\n      border: 1px solid rgba(255, 255, 255, 0.125) !important;\n      color: var(--text-primary) !important;\n      padding: 0.5rem 1rem !important;\n      width: 100% !important;\n      margin-bottom: 1rem !important;\n    ";const c=document.createElement("div");c.className="modal-footer",c.style.cssText="\n      border-top: 1px solid rgba(255, 255, 255, 0.125) !important;\n      padding: 1rem !important;\n      justify-content: flex-end !important;\n    ";const l=document.createElement("button");l.type="button",l.className="btn",l.innerText="Login",l.style.cssText="\n      background-color: var(--accent-color) !important;\n      border-color: var(--accent-color) !important;\n      color: var(--text-primary) !important;\n      margin-left: 0.5rem !important;\n      transition: background-color 0.2s ease-in-out !important;\n    ",l.addEventListener("mouseover",(()=>{l.style.backgroundColor="var(--accent-color-light) !important"})),l.addEventListener("mouseout",(()=>{l.style.backgroundColor="var(--accent-color) !important"}));const d=document.createElement("button");d.type="button",d.className="btn",d.innerText="Close",d.style.cssText="\n      background-color: var(--bg-secondary) !important;\n      border-color: var(--bg-secondary) !important;\n      color: var(--text-muted) !important;\n      transition: background-color 0.2s ease-in-out !important;\n    ",d.addEventListener("mouseover",(()=>{d.style.backgroundColor="var(--bg-primary) !important"})),d.addEventListener("mouseout",(()=>{d.style.backgroundColor="var(--bg-secondary) !important"}));const m=document.createElement("div");m.className="alert alert-danger d-none",m.style.cssText="\n      margin-top: 1rem !important;\n      display: none !important;\n    ",l.onclick=()=>{const e=s.value;m.style.display="none !important",l.disabled=!0,l.innerHTML='<span class="spinner-border spinner-border-sm"></span> Logging in...',fetch("https://api3.jailbreakchangelogs.xyz/users/get/token?token="+e).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((t=>{if(!t)throw new Error("Invalid token");Cookies.remove("token"),Cookies.set("token",e,{expires:7});const o=`https://cdn.discordapp.com/avatars/${t.id}/${t.avatar}.png`;localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("avatar",o),localStorage.setItem("userid",t.id),i(),window.location.reload()})).catch((e=>{console.error("Error fetching user data:",e),m.style.display="block !important",m.textContent="Invalid token or network error. Please try again.",l.disabled=!1,l.innerText="Login"}))},d.onclick=i,n.appendChild(a),r.appendChild(s),r.appendChild(m),c.appendChild(d),c.appendChild(l),o.appendChild(n),o.appendChild(r),o.appendChild(c),t.appendChild(o),e.appendChild(t);const u=document.createElement("div");u.className="modal-backdrop fade show",u.style.cssText="\n      opacity: 0.5 !important;\n      background-color: #000 !important;\n    ",document.body.appendChild(u),document.body.appendChild(e),setTimeout((()=>s.focus()),100);const p=e=>{"Escape"===e.key&&(i(),document.removeEventListener("keydown",p))};document.addEventListener("keydown",p)}()))})),window.getAuthToken=function(){return Cookies.get("token")};const c=new URLSearchParams(window.location.search).get("campaign")||sessionStorage.getItem("campaign");if(c){const e=Cookies.get("token");e?(fetch("https://api3.jailbreakchangelogs.xyz/campaigns/count?campaign="+c+"&token="+e,{method:"POST",headers:{"Content-Type":"application/json"}}),sessionStorage.removeItem("campaign")):(notyf.info("We noticed you're visiting from a campaign. Please log in to count your visit!","Campaign Visit"),sessionStorage.setItem("campaign",c))}window.logout=function(){localStorage.removeItem("user"),localStorage.removeItem("avatar"),localStorage.removeItem("userid"),localStorage.removeItem("showWelcome"),Cookies.remove("token",{path:"/",secure:!0,sameSite:"Strict"}),window.location.reload()}}));